import{d as a,u as l,s as t,r as e,c as o,h as s,a as n,b as i,t as r,j as d,m as p,N as c,O as b,F as m,z as u,P as g,Q as f,R as v,o as y}from"./chunk-Bmj9xSPk.js";import{D as h}from"./chunk-BR6EO_m4.js";import{u as x,i as k,a as _}from"./chunk-CvLE_cZp.js";import{r as A}from"./chunk-Dv7RK_ed.js";const N={class:"modal-box"},T={class:"text-lg font-bold"},w={class:"py-4"},D={class:"modal-action"},C={method:"dialog",class:"flex gap-3"},P={class:"modal-box"},z={class:"text-lg font-bold"},j={class:"py-4"},W={class:"modal-action"},S={method:"dialog",class:"flex gap-3"},O={class:"min-w-1000px"},J={class:"flex gap-3 mb-4"},L=["data-tip"],M=["download","href"],R={class:""},V={for:"explore"},E=["data-tip"],$={class:"btn btn-primary btn-sm"},F={class:""},I={for:"explore-department"},Q=["data-tip"],U={class:"btn btn-info btn-sm"},q={class:"flex items-center gap-3 mb-4"},B={class:"form-control"},G=["value"],H={class:"text-sm"},K={class:"font-bold"},X={class:"font-bold"},Y=".xlsx,.xls",Z=a({__name:"PersonAll",setup(a){const{t:Z}=l(),aa=x().personConfig,{getAllPersonList:la,getAlreadyPersonList:ta}=t(aa),ea=e(),oa=e();async function sa(a,l=!0){const t=await A(a.target.files[0]),e=g(t,{type:"binary",cellDates:!0}),o=e.Sheets[e.SheetNames[0]],s=f.sheet_to_json(o),n=_(s);l&&aa.resetPerson(),aa.addNotPersonList(n)}function na(){let a=JSON.parse(JSON.stringify(la.value));for(let t=0;t<a.length;t++)delete a[t].x,delete a[t].y,delete a[t].id,delete a[t].createTime,delete a[t].updateTime,delete a[t].prizeId,a[t].isWin?a[t].isWin=k.global.t("data.yes"):a[t].isWin=k.global.t("data.no"),a[t].prizeTime=a[t].prizeTime.join(","),a[t].prizeName=a[t].prizeName.join(",");let l=JSON.stringify(a);if(l=l.replaceAll(/uid/g,k.global.t("data.number")).replaceAll(/isWin/g,k.global.t("data.isWin")).replaceAll(/department/g,k.global.t("data.department")).replaceAll(/name/g,k.global.t("data.name")).replaceAll(/identity/g,k.global.t("data.identity")).replaceAll(/prizeName/g,k.global.t("data.prizeName")).replaceAll(/prizeTime/g,k.global.t("data.prizeTime")),a=JSON.parse(l),a.length>0){const l=f.json_to_sheet(a),t=f.book_new();f.book_append_sheet(t,l,"Sheet1"),v(t,"data.xlsx")}}function ia(){aa.resetAlreadyPerson()}function ra(){aa.deleteAllPerson()}const da=[{label:k.global.t("data.number"),props:"uid"},{label:k.global.t("data.name"),props:"name"},{label:k.global.t("data.department"),props:"department"},{label:k.global.t("data.avatar"),props:"avatar",formatValue:a=>a.avatar?`<img src="${a.avatar}" alt="avatar" style="width: 50px; height: 50px;"/>`:"-"},{label:k.global.t("data.identity"),props:"identity"},{label:k.global.t("data.isWin"),props:"isWin",formatValue:a=>a.isWin?k.global.t("data.yes"):k.global.t("data.no")},{label:k.global.t("data.operation"),actions:[{label:k.global.t("data.delete"),type:"btn-error",onClick:a=>{!function(a){aa.deletePerson(a)}(a)}}]}],pa=o(()=>{const a=new Set;return la.value.forEach(l=>{l.department&&a.add(l.department)}),Array.from(a)}),ca=e(""),ba=o(()=>ca.value?la.value.filter(a=>a.department===ca.value):la.value);return s(()=>{}),(a,l)=>(y(),n(m,null,[i("dialog",{id:"my_modal_1",ref_key:"resetDataDialog",ref:ea,class:"border-none modal"},[i("div",N,[i("h3",T,r(d(Z)("dialog.titleTip")),1),i("p",w,r(d(Z)("dialog.dialogResetWinner")),1),i("div",D,[i("form",C,[i("button",{class:"btn",onClick:l[0]||(l[0]=a=>ea.value.close())},r(d(Z)("button.cancel")),1),i("button",{class:"btn",onClick:ia},r(d(Z)("button.confirm")),1)])])])],512),i("dialog",{id:"my_modal_1",ref_key:"delAllDataDialog",ref:oa,class:"border-none modal"},[i("div",P,[i("h3",z,r(d(Z)("dialog.titleTip")),1),i("p",j,r(d(Z)("dialog.dialogDelAllPerson")),1),i("div",W,[i("form",S,[i("button",{class:"btn",onClick:l[1]||(l[1]=a=>oa.value.close())},r(d(Z)("button.cancel")),1),i("button",{class:"btn",onClick:ra},r(d(Z)("button.confirm")),1)])])])],512),i("div",O,[i("h2",null,r(d(Z)("viewTitle.personManagement")),1),i("div",J,[i("button",{class:"btn btn-error btn-sm",onClick:l[2]||(l[2]=a=>oa.value.showModal())},r(d(Z)("button.allDelete")),1),i("div",{class:"tooltip tooltip-bottom","data-tip":d(Z)("tooltip.downloadTemplateTip")},[i("a",{class:"no-underline btn btn-secondary btn-sm",download:d(Z)("data.xlsxName"),target:"_blank",href:`/log-lottery/${d(Z)("data.xlsxName")}`},r(d(Z)("button.downloadTemplate")),9,M)],8,L),i("div",R,[i("label",V,[i("div",{class:"tooltip tooltip-bottom","data-tip":d(Z)("tooltip.uploadExcelTip")},[i("input",{id:"explore",type:"file",class:"",style:{display:"none"},accept:Y,onChange:l[3]||(l[3]=a=>sa(a,!0))},null,32),i("span",$,r(d(Z)("button.importData")),1)],8,E)])]),i("div",F,[i("label",I,[i("div",{class:"tooltip tooltip-bottom","data-tip":d(Z)("tooltip.uploadDepartmentTip")},[i("input",{id:"explore-department",type:"file",class:"",style:{display:"none"},accept:Y,onChange:l[4]||(l[4]=a=>sa(a,!1))},null,32),i("span",U,r(d(Z)("button.importDepartmentData")),1)],8,Q)])]),i("button",{class:"btn btn-error btn-sm",onClick:l[5]||(l[5]=a=>ea.value.showModal())},r(d(Z)("button.resetData")),1),i("button",{class:"btn btn-accent btn-sm",onClick:na},r(d(Z)("button.exportResult")),1),i("div",null,[i("span",null,r(d(Z)("table.luckyPeopleNumber"))+":",1),i("span",null,r(d(ta).length),1),l[7]||(l[7]=i("span",null," / ",-1)),i("span",null,r(d(la).length),1)])]),i("div",q,[i("div",B,[l[9]||(l[9]=i("label",{class:"label"},[i("span",{class:"label-text"},"按部门筛选：")],-1)),c(i("select",{class:"select select-bordered select-sm w-40","onUpdate:modelValue":l[6]||(l[6]=a=>ca.value=a)},[l[8]||(l[8]=i("option",{value:""},"全部部门",-1)),(y(!0),n(m,null,u(pa.value,a=>(y(),n("option",{key:a,value:a},r(a),9,G))),128))],512),[[b,ca.value]])]),i("div",H,[l[10]||(l[10]=i("span",null,"当前显示：",-1)),i("span",K,r(ba.value.length),1),l[11]||(l[11]=i("span",null,"人（共",-1)),i("span",X,r(d(la).length),1),l[12]||(l[12]=i("span",null,"人）",-1))])]),p(h,{"table-columns":da,data:ba.value},null,8,["data"])])],64))}});export{Z as default};
