import{a6 as a,r as t,c as l,o as e,W as o,X as s,bg as n,u as i,a3 as r,bL as p,bA as d,F as c,b0 as m,aS as b}from"./chunk-CuUUEVgY.js";import{D as u}from"./chunk-rLc4Cqhf.js";import{u as g,i as f,a as h}from"./chunk-Dal6fL2O.js";import{r as v}from"./chunk-Dv7RK_ed.js";import{s as k}from"./chunk-vv8T6d3M.js";import{u as y}from"./chunk-CIRXpJyU.js";import{r as x,u as j,w as A}from"./chunk-C5xT2hrF.js";import"./chunk-CZH_E4qY.js";import"./chunk-jVKjNuRY.js";import"./chunk-BYM7fZuu.js";import"./chunk-DUzMzk5W.js";import"./chunk-T1cRhSFL.js";import"./chunk-BcwQrg-K.js";import"./chunk-DOLF-9o1.js";import"./chunk-CwkjfrOa.js";import"./chunk-rd0oqKqK.js";import"./chunk-ChzSki6g.js";import"./chunk-DHt_odDz.js";import"./chunk-Dcea1vLA.js";const _={class:"modal-box"},w={class:"text-lg font-bold"},T={class:"py-4"},D={class:"modal-action"},N={method:"dialog",class:"flex gap-3"},C={class:"modal-box"},P={class:"text-lg font-bold"},W={class:"py-4"},z={class:"modal-action"},S={method:"dialog",class:"flex gap-3"},J={class:"min-w-1000px"},L={class:"flex gap-3 mb-4"},O=["data-tip"],M=["download","href"],V={class:""},E={for:"explore"},R=["data-tip"],$={class:"btn btn-primary btn-sm"},B={class:""},F={for:"explore-department"},I=["data-tip"],U={class:"btn btn-info btn-sm"},X={class:"flex items-center gap-3 mb-4"},q={class:"form-control"},G=["value"],H={class:"text-sm"},K={class:"font-bold"},Q={class:"font-bold"},Y=".xlsx,.xls",Z=a({__name:"PersonAll",setup(a){const{t:Z}=y(),aa=g().personConfig,{getAllPersonList:ta,getAlreadyPersonList:la}=k(aa),ea=t(),oa=t();async function sa(a,t=!0){const l=await v(a.target.files[0]),e=x(l,{type:"binary",cellDates:!0}),o=e.Sheets[e.SheetNames[0]],s=j.sheet_to_json(o),n=h(s);t&&aa.resetPerson(),aa.addNotPersonList(n)}function na(){let a=JSON.parse(JSON.stringify(ta.value));for(let l=0;l<a.length;l++)delete a[l].x,delete a[l].y,delete a[l].id,delete a[l].createTime,delete a[l].updateTime,delete a[l].prizeId,a[l].isWin?a[l].isWin=f.global.t("data.yes"):a[l].isWin=f.global.t("data.no"),a[l].prizeTime=a[l].prizeTime.join(","),a[l].prizeName=a[l].prizeName.join(",");let t=JSON.stringify(a);if(t=t.replaceAll(/uid/g,f.global.t("data.number")).replaceAll(/isWin/g,f.global.t("data.isWin")).replaceAll(/department/g,f.global.t("data.department")).replaceAll(/name/g,f.global.t("data.name")).replaceAll(/identity/g,f.global.t("data.identity")).replaceAll(/prizeName/g,f.global.t("data.prizeName")).replaceAll(/prizeTime/g,f.global.t("data.prizeTime")),a=JSON.parse(t),a.length>0){const t=j.json_to_sheet(a),l=j.book_new();j.book_append_sheet(l,t,"Sheet1"),A(l,"data.xlsx")}}function ia(){aa.resetAlreadyPerson()}function ra(){aa.deleteAllPerson()}const pa=[{label:f.global.t("data.number"),props:"uid"},{label:f.global.t("data.name"),props:"name"},{label:f.global.t("data.department"),props:"department"},{label:f.global.t("data.avatar"),props:"avatar",formatValue:a=>a.avatar?`<img src="${a.avatar}" alt="avatar" style="width: 50px; height: 50px;"/>`:"-"},{label:f.global.t("data.identity"),props:"identity"},{label:f.global.t("data.isWin"),props:"isWin",formatValue:a=>a.isWin?f.global.t("data.yes"):f.global.t("data.no")},{label:f.global.t("data.operation"),actions:[{label:f.global.t("data.delete"),type:"btn-error",onClick:a=>{!function(a){aa.deletePerson(a)}(a)}}]}],da=l(()=>{const a=new Set;return ta.value.forEach(t=>{t.department&&a.add(t.department)}),Array.from(a)}),ca=t(""),ma=l(()=>ca.value?ta.value.filter(a=>a.department===ca.value):ta.value);return e(()=>{}),(a,t)=>(b(),o(c,null,[s("dialog",{id:"my_modal_1",ref_key:"resetDataDialog",ref:ea,class:"border-none modal"},[s("div",_,[s("h3",w,n(i(Z)("dialog.titleTip")),1),s("p",T,n(i(Z)("dialog.dialogResetWinner")),1),s("div",D,[s("form",N,[s("button",{class:"btn",onClick:t[0]||(t[0]=a=>ea.value.close())},n(i(Z)("button.cancel")),1),s("button",{class:"btn",onClick:ia},n(i(Z)("button.confirm")),1)])])])],512),s("dialog",{id:"my_modal_1",ref_key:"delAllDataDialog",ref:oa,class:"border-none modal"},[s("div",C,[s("h3",P,n(i(Z)("dialog.titleTip")),1),s("p",W,n(i(Z)("dialog.dialogDelAllPerson")),1),s("div",z,[s("form",S,[s("button",{class:"btn",onClick:t[1]||(t[1]=a=>oa.value.close())},n(i(Z)("button.cancel")),1),s("button",{class:"btn",onClick:ra},n(i(Z)("button.confirm")),1)])])])],512),s("div",J,[s("h2",null,n(i(Z)("viewTitle.personManagement")),1),s("div",L,[s("button",{class:"btn btn-error btn-sm",onClick:t[2]||(t[2]=a=>oa.value.showModal())},n(i(Z)("button.allDelete")),1),s("div",{class:"tooltip tooltip-bottom","data-tip":i(Z)("tooltip.downloadTemplateTip")},[s("a",{class:"no-underline btn btn-secondary btn-sm",download:i(Z)("data.xlsxName"),target:"_blank",href:`/log-lottery/${i(Z)("data.xlsxName")}`},n(i(Z)("button.downloadTemplate")),9,M)],8,O),s("div",V,[s("label",E,[s("div",{class:"tooltip tooltip-bottom","data-tip":i(Z)("tooltip.uploadExcelTip")},[s("input",{id:"explore",type:"file",class:"",style:{display:"none"},accept:Y,onChange:t[3]||(t[3]=a=>sa(a,!0))},null,32),s("span",$,n(i(Z)("button.importData")),1)],8,R)])]),s("div",B,[s("label",F,[s("div",{class:"tooltip tooltip-bottom","data-tip":i(Z)("tooltip.uploadDepartmentTip")},[s("input",{id:"explore-department",type:"file",class:"",style:{display:"none"},accept:Y,onChange:t[4]||(t[4]=a=>sa(a,!1))},null,32),s("span",U,n(i(Z)("button.importDepartmentData")),1)],8,I)])]),s("button",{class:"btn btn-error btn-sm",onClick:t[5]||(t[5]=a=>ea.value.showModal())},n(i(Z)("button.resetData")),1),s("button",{class:"btn btn-accent btn-sm",onClick:na},n(i(Z)("button.exportResult")),1),s("div",null,[s("span",null,n(i(Z)("table.luckyPeopleNumber"))+":",1),s("span",null,n(i(la).length),1),t[7]||(t[7]=s("span",null," / ",-1)),s("span",null,n(i(ta).length),1)])]),s("div",X,[s("div",q,[t[9]||(t[9]=s("label",{class:"label"},[s("span",{class:"label-text"},"按部门筛选：")],-1)),p(s("select",{class:"select select-bordered select-sm w-40","onUpdate:modelValue":t[6]||(t[6]=a=>ca.value=a)},[t[8]||(t[8]=s("option",{value:""},"全部部门",-1)),(b(!0),o(c,null,m(da.value,a=>(b(),o("option",{key:a,value:a},n(a),9,G))),128))],512),[[d,ca.value]])]),s("div",H,[t[10]||(t[10]=s("span",null,"当前显示：",-1)),s("span",K,n(ma.value.length),1),t[11]||(t[11]=s("span",null,"人（共",-1)),s("span",Q,n(i(ta).length),1),t[12]||(t[12]=s("span",null,"人）",-1))])]),r(u,{"table-columns":pa,data:ma.value},null,8,["data"])])],64))}});export{Z as default};
